<mat-dialog-content class="project-dialog-body">
  <div class="tabs" style="margin: 8px 0 12px; display:flex; gap:8px;">
    <button mat-stroked-button color="primary"
            [class.is-active]="mode==='demo'"
            type="button" (click)="setMode('demo')">Aperçu</button>

    <button mat-stroked-button color="primary"
            [class.is-active]="mode==='code'"
            type="button" (click)="setMode('code')">Résumé</button>
  </div>

  <!-- Présentation -->
  <ng-container *ngIf="mode==='demo'; else codeTpl">
    <div class="carousel" role="region" aria-label="Aperçu du projet" style="position:relative;">
      <img [src]="images[idx]" [alt]="p.title + ' capture ' + (idx+1)" />
      <button *ngIf="images.length>1" mat-icon-button class="nav prev" type="button" aria-label="Image précédente" (click)="prev()">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button *ngIf="images.length>1" mat-icon-button class="nav next" type="button" aria-label="Image suivante" (click)="next()">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>

    <!-- descShort (ou descLong) -->
    <p class="desc">{{ p.descShort || p.descLong }}</p>

    <div class="ext" *ngIf="p.demo">
      <a mat-stroked-button color="primary" [href]="p.demo" target="_blank" rel="noopener">Ouvrir la démo</a>
    </div>
  </ng-container>

  <!-- Résumé -->
  <ng-template #codeTpl>
    <!-- PSI en premier -->
    <div class="psi-block" *ngIf="p.problemSolutionImpact as psi">
      <p><strong>Problème :</strong> {{ psi.problem }}</p>
      <p><strong>Solution :</strong> {{ psi.solution }}</p>
      <p><strong>Impact :</strong> {{ psi.impact }}</p>
    </div>

    <!--  descLong (ou descShort) -->
    <p class="desc">{{ p.descLong || p.descShort }}</p>

    <!--  Highlights -->
    <ul *ngIf="(p.highlights?.length || 0) > 0" class="list">
      <li *ngFor="let h of p.highlights">{{ h }}</li>
    </ul>

    <!-- Liens externes -->
    <div class="ext">
      <a *ngIf="p.code" mat-stroked-button color="primary" [href]="p.code" target="_blank" rel="noopener">Voir le repo GitHub</a>
      <a *ngIf="p.demo" mat-stroked-button [href]="p.demo" target="_blank" rel="noopener">Ouvrir la démo</a>
    </div>
  </ng-template>
</mat-dialog-content>
