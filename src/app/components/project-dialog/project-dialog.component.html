<h2 mat-dialog-title>
  {{ p.title }}
  <div class="subtitle">{{ p.role }} — {{ p.stack.join(' · ') }}</div>
</h2>

<mat-dialog-content>
  <div class="tabs" style="margin: 8px 0 12px; display:flex; gap:8px;">
    <button mat-stroked-button color="primary"
            [class.is-active]="mode==='demo'"
            type="button" (click)="setMode('demo')">Presentation</button>

    <button mat-stroked-button color="primary"
            [class.is-active]="mode==='code'"
            type="button" (click)="setMode('code')">Résumé</button>
  </div>

  <!-- Bloc description, selon le mode -->
  <ng-container *ngIf="mode==='demo'; else codeTpl">
    <div class="carousel" role="region" aria-label="Aperçu du projet" style="position:relative;">
      <img [src]="images[idx]" [alt]="p.title + ' capture ' + (idx+1)" />
      <button *ngIf="images.length>1" mat-icon-button class="nav prev" type="button" aria-label="Image précédente" (click)="prev()">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button *ngIf="images.length>1" mat-icon-button class="nav next" type="button" aria-label="Image suivante" (click)="next()">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>

    <p class="desc" *ngIf="p.descLong; else short">{{ p.descLong }}</p>
    <ng-template #short><p class="desc">{{ p.descShort }}</p></ng-template>

    <div class="psi-block" *ngIf="p.problemSolutionImpact">
      <p><strong>Problème :</strong> {{ p.problemSolutionImpact.problem }}</p>
      <p><strong>Solution :</strong> {{ p.problemSolutionImpact.solution }}</p>
      <p><strong>Impact :</strong> {{ p.problemSolutionImpact.impact }}</p>
    </div>

    <div class="ext" *ngIf="p.demo">
      <a mat-stroked-button color="primary" [href]="p.demo" target="_blank" rel="noopener">Ouvrir la démo</a>
    </div>
  </ng-container>

  <ng-template #codeTpl>
    <p class="desc">{{ p.descShort || p.descLong }}</p>
    <div class="ext">
      <a *ngIf="p.code" mat-stroked-button color="primary" [href]="p.code" target="_blank" rel="noopener">Voir le repo GitHub</a>
      <a *ngIf="p.demo" mat-stroked-button [href]="p.demo" target="_blank" rel="noopener">Ouvrir la démo</a>
    </div>
  </ng-template>

  <!-- ✅ Highlights visibles dans les deux modes -->
  <ul *ngIf="(p.highlights?.length || 0) > 0" class="list">
    <li *ngFor="let h of p.highlights">{{ h }}</li>
  </ul>
</mat-dialog-content>


<mat-dialog-actions align="end">
  <button mat-button mat-dialog-close type="button">Fermer</button>
</mat-dialog-actions>
